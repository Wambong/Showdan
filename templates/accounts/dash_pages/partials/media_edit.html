{# expects: cfg, items, form #}
{% load i18n %}
<div id="dashMedia-{{ cfg.kind }}" class="mb-4">

  <div class="d-flex align-items-center justify-content-between mb-2">
    <h5 class="text-white mb-0">{% translate "Edit" %} â€” {{ cfg.title }}</h5>

    <a class="btn btn-sm btn-outline-light"
       href="{% url 'accounts:dash_media_section' cfg.kind %}"
       hx-get="{% url 'accounts:dash_media_section' cfg.kind %}"
       hx-target="#dashMedia-{{ cfg.kind }}"
       hx-swap="outerHTML"
       hx-push-url="false">
      Cancel
    </a>
  </div>

  <form method="post"
        enctype="multipart/form-data"
        hx-post="{% url 'accounts:dash_media_section_edit' cfg.kind %}"
        hx-encoding="multipart/form-data"
        hx-target="#dashMedia-{{ cfg.kind }}"
        hx-swap="outerHTML"
        hx-push-url="false">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert-danger">{{ form.non_field_errors }}</div>
    {% endif %}

    <!-- Existing items with delete checkboxes -->
    {% if items %}
      <div class="text-white-50 small mb-2">{% translate "Select items to delete" %}</div>

      {% if cfg.item_type == "image" %}
        <div class="row g-3 mb-3">
          {% for x in items %}
            <div class="col-6 col-md-4 col-lg-3">
              <label class="d-block">
                <div class="position-relative">
                  <img src="{{ x.image.url }}" class="img-fluid rounded border" alt="">
                  <div class="position-absolute top-0 start-0 p-2">
                    <input class="form-check-input" type="checkbox" name="delete_ids" value="{{ x.id }}">
                  </div>
                </div>
              </label>
            </div>
          {% endfor %}
        </div>

      {% elif cfg.item_type == "audio" %}
        <div class="list-group mb-3">
          {% for x in items %}
            <label class="list-group-item d-flex align-items-center gap-2">
              <input class="form-check-input" type="checkbox" name="delete_ids" value="{{ x.id }}">
              <span class="fw-semibold">{{ x.title|default:"Audio cover" }}</span>
              <span class="ms-auto text-muted small">{{ x.uploaded_at }}</span>
            </label>
          {% endfor %}
        </div>

      {% elif cfg.item_type == "video" %}
        <div class="list-group mb-3">
          {% for x in items %}
            <label class="list-group-item d-flex align-items-center gap-2">
              <input class="form-check-input" type="checkbox" name="delete_ids" value="{{ x.id }}">
              <span class="fw-semibold">{{ x.title|default:"Video cover" }}</span>
              <span class="ms-auto text-muted small">{{ x.uploaded_at }}</span>
            </label>
          {% endfor %}
        </div>
      {% endif %}
    {% endif %}

    <!-- Upload -->
    <div class="mb-3">
      <div class="text-white-50 small mb-2">{% translate "Upload more" %}</div>

      {# Render the correct upload field based on cfg.kind #}
      {% if cfg.kind == "professional" %}
        {{ form.professional_images }}
        {% if form.professional_images.errors %}<div class="text-danger small mt-1">{{ form.professional_images.errors }}</div>{% endif %}
      {% elif cfg.kind == "normal" %}
        {{ form.normal_images }}
        {% if form.normal_images.errors %}<div class="text-danger small mt-1">{{ form.normal_images.errors }}</div>{% endif %}
      {% elif cfg.kind == "audio" %}
        {{ form.audio_files }}
        {% if form.audio_files.errors %}<div class="text-danger small mt-1">{{ form.audio_files.errors }}</div>{% endif %}
      {% elif cfg.kind == "video" %}
        {{ form.video_files }}
        {% if form.video_files.errors %}<div class="text-danger small mt-1">{{ form.video_files.errors }}</div>{% endif %}
      {% endif %}
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-sm btn-primary" type="submit">{% translate "Save changes" %}</button>

      <a class="btn btn-sm btn-outline-light"
         href="{% url 'accounts:dash_media_section' cfg.kind %}"
         hx-get="{% url 'accounts:dash_media_section' cfg.kind %}"
         hx-target="#dashMedia-{{ cfg.kind }}"
         hx-swap="outerHTML"
         hx-push-url="false">
        {% translate "Cancel" %}
      </a>
    </div>
  </form>
</div>
